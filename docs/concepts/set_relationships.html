<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="fontawesome/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- Mermaid -->
        <link rel="stylesheet" href="mermaid/mermaid.css">
        <script type="text/javascript" src="mermaid/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true,useMaxWidth:false});</script>

        <!-- functionplot -->
        <!-- <script type="text/javascript" src="functionplot/d3.v3.min.js"></script> -->
        <!-- <script type="text/javascript" src="functionplot/math.min.js"></script> -->
        <!-- <script type="text/javascript" src="functionplot/function-plot.js"></script> -->

        <!-- jsxgraph -->
        <script type="text/javascript" src="jsxgraph/jsxgraphcore.js"></script>
        <link rel="stylesheet" type="text/css" href="jsxgraph/jsxgraph.css" />

        <!-- MathJax -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"] ],
              displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
              processEscapes: false,
              balanceBraces: true,
              skipTags: ["script","noscript","style","textarea","pre","code","annotation","annotation-xml"],
              ignoreClass: "tex2jax_ignore"
            },
            asciimath2jax: {
             delimiters: [
                   ['`','`']
                 ],
             skipTags: ["script","noscript","style","textarea","pre","code","annotation","annotation-xml"],
             preview: "AsciiMath"
            },
            showProcessingMessages: true,
            messageStyle: "normal",
            displayAlign: "center",
            displayIndent: "0",
            showMathMenu: true,
            "HTML-CSS": { availableFonts: ["TeX"] }
          });
        </script>
        <script type="text/javascript" src="mathjax/MathJax.js"></script>


        <!-- nomnoml -->
        <!--<script src="nomnoml/zepto.min.js"></script>-->
        <script src="nomnoml/lodash.min.js"></script>
        <script src="nomnoml/dagre.min.js"></script>
        <script src="nomnoml/skanaar.util.js"></script>
        <script src="nomnoml/skanaar.svg.js"></script>
        <script src="nomnoml/skanaar.vector.js"></script>
        <script src="nomnoml/skanaar.canvas.js"></script>
        <script src="nomnoml/nomnoml.jison.js"></script>
        <script src="nomnoml/nomnoml.parser.js"></script>
        <script src="nomnoml/nomnoml.layouter.js"></script>
        <script src="nomnoml/nomnoml.renderer.js"></script>
        <script src="nomnoml/nomnoml.js"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <!--<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>-->
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="intro/introduction.html">Introduction</a></li><li><a href="./intro/why_virtdata.html"><strong>1.</strong> Why Virtual Data?</a></li><li><ul class="section"><li><a href="./rendercheck/typography.html"><strong>1.1.</strong> Typography</a></li><li><a href="intro/history.html"><strong>1.2.</strong> VirtData History</a></li></ul></li><li><a href="concepts/concepts.html"><strong>2.</strong> VirtData Concepts</a></li><li><ul class="section"><li><a href="concepts/data_mapping_functions.html"><strong>2.1.</strong> Data Mapping Functions</a></li><li><a href="./concepts/modeling_cardinality.html"><strong>2.2.</strong> Modeling Cardinality</a></li><li><a href="./concepts/set_relationships.html" class="active"><strong>2.3.</strong> Set Relationships</a></li></ul></li><li><a href="./intro/coming_soon.html"><strong>3.</strong> ComingSoon</a></li><li class="affix"><a href="./matter/glossary.html">Glossary</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <h1>Set Relationships</h1>
<p>This section will talk about how to model relative cardinality between
different types of entities. Before reading this, you should already
be familiar with <a href="/concepts/data_mapping_functions.html">data mapping</a>
and <a href="modeling_cardinality.html">cardinality functions</a>.</p>
<p>Suppose you have two different sets of things in your virtual dataset:</p>
<script class="nomnoml-text" type="text/plain">
#zoom:0.75
#direction:right
#.data: fill=#FFFFFF visual=frame
[entity type A|
[<data> "foo"]
[<data> "bar"]
[<data> "baz"]
]
</script>
<script class="nomnoml-text" type="text/plain">
#zoom:0.75
#direction:right
#.data: fill=#FFFFFF visual=frame
[entity type B|
[<data> "X"]
[<data> "Y"]
[<data> "Z"]
]
</script>
<p>It may be the case that there is no association between elements of the first set to
the second set, as illustrated above.</p>
<p>You could have a many-to-many association from set A to set B, like this:</p>
<script class="nomnoml-text" type="text/plain">
#zoom:1.0
#direction:down
#.data: fill=#FFFFFF visual=frame
[<data> foo]
[<data> bar]
[<data> baz]
[<data> X]
[<data> Y]
[<data> Z]
[foo] -> [X]
[foo] -> [Y]
[foo] -> [Z]
[bar] -> [X]
[bar] -> [Y]
[bar] -> [Z]
[baz] -> [X]
[baz] -> [Y]
[baz] -> [Z]
</script>
<p>In any case, the associations are themselves part of the data set. They must be
modeled as such. The way that we do this in virtual dataset is to group our
functions in the same way that data should be grouped.</p>
<p>Isolating the values that we use for for uniqueness is a key step.
Assume for now, that you are using a simple long value to identify each
unique entity or instance of your virtual dataset. For example, <em>foo</em>
is entity 0, <em>bar</em> is entity 1, and <em>baz</em> is entity 2. The same applies
for X, Y and Z: X is 0, Y is 1, and Z is 2.</p>
<p>Let's make this clear in terms of the value groupings that we would need to simulate
for a full association between all type-A entities and all type-B entities. Here are
the tuples: (0,0), (0,1), (0,2), (1,0), (1,1), (1,2), (2,0), (2,1), (2,2).</p>
<p>Another way to say this is that &quot;All members of set A are associated with
All members of Set B&quot;.</p>
<p>A simple modulo function that does only range adjustment for the sizes of these two
populations is simply &quot;mod 3&quot;. You could draw many many samples via a mapping function,
but as long as the mapping functions are the <em>same</em>, you would get the same identifier
value for each entity in the tuple. You could only ever get (0,0), (1,1), and (2,2).
This does not suffice for our nine different associations above.</p>
<p>Let us look at the associations directly, and work backwards to find the appropriate
functions that will maintain the correspondence.</p>
<p>Here are the associations, enumerated by sample number (coordinate value). The discrete
correspondence is captured for A and B in a more visually obvious way in the columns
to the right.</p>
<pre><code>sample=#  association  A map   B map

sample=0  (0,0)        0-&gt;0    0-&gt;0
sample=1  (0,1)        1-&gt;0    1-&gt;1
sample=2  (0,2)        2-&gt;0    2-&gt;2
sample=3  (1,0)        3-&gt;1    3-&gt;0
sample=4  (1,1)        4-&gt;1    4-&gt;1
sample=5  (1,2)        5-&gt;1    5-&gt;2
sample=6  (2,0)        6-&gt;2    6-&gt;0
sample=7  (2,1)        7-&gt;2    7-&gt;1
sample=8  (2,2)        8-&gt;2    8-&gt;2

sample=9  (0,0)        9-&gt;0    9-&gt;0
sample=10 (0,1)       10-&gt;0   10-&gt;1
sample=11 (0,2)       11-&gt;0   11-&gt;2
...       ...         ...     ...
</code></pre>
<p>In this case, we can see that the functions must do more than simply correct for the
possible number of unique identifiers in each population. They must also have
some type of relationship that adjust for the relative rates of progression through
the possible values. For every A value, we need to see one each of B. In other words,
we need to see a new A value about 1/3 as frequently as we see a new B value.</p>
<p>For A, we need a function like &quot;divide by 3, then modulo by 3&quot;.
For B, simply &quot;modulo by 3&quot;. By dividing the sampling input by a number, we reduce
its rate of progression.</p>
<p>Although we are looking at correspondence between discrete values (the counting numbers),
it is easy to demonstrate on a coordinate plane as well using standard plotting tools.</p>
<p>First, by using a floor function to visually illustrate the discrete mapping:</p>
<div id="fpthrees1" style="width: 400px; height: 200px;"></div> 
<script type="text/javascript">
brd = JXG.JSXGraph.initBoard('fpthrees1', {boundingbox: [-1, 4, 20, -1], axis:true, showCopyright: false});
 brd.suspendUpdate();
 var c1 = brd.create('functiongraph', [function(x){ return (Math.floor(x) % 3); }],
                       {strokeWidth:2,strokeColor:'black'});
 var c2 = brd.create('functiongraph', [function(x){ return (Math.floor(x/3.0) % 3); }],
                       {strokeWidth:5,strokeColor:'blue',strokeOpacity:'0.25'});  
 brd.unsuspendUpdate();
</script>
<p>And second, the continuous analog, to show the relative slope
and repeating patterns at every 9th interval:</p>
<div id="fpthrees2" style="width: 400px; height: 200px;"></div> 
<script type="text/javascript">
brd = JXG.JSXGraph.initBoard('fpthrees2', {boundingbox: [-1, 4, 20, -1], axis:true, showCopyright: false});
 brd.suspendUpdate();
 var c3 = brd.create('functiongraph', [function(x){ return (x % 3); }],
                       {strokeWidth:2,strokeColor:'black'});
 var c4 = brd.create('functiongraph', [function(x){ return ((x/3.0) % 3); }],
                       {strokeWidth:5,strokeColor:'blue',strokeOpacity:'0.25'});  
 brd.unsuspendUpdate();
</script>
<h3>So What?</h3>
<p>From all this we can see one of the most basic strategies for establishing a one-to-many
relationship. The basic rule is that the <em>many</em> side of the relationship must
have exactly <em>that many</em> more values per coordinate range than the <em>one</em> side. It is
usually just a matter of adjusting the relative rates of progression along the
coordinate line, as illustrated above.</p>
<p>Also, the example above is very basic. It shows a regular repeating pattern with
a full one-to-many association. How do we extrapolate this to other more advanced examples?
This is a more advanced topic that will be explored in the future. For now, refer
to the recipes section for some ideas.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="./concepts/modeling_cardinality.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="./intro/coming_soon.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./concepts/modeling_cardinality.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./intro/coming_soon.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <script>
//            var target = document.getElementById('nomnoml-view1');
//            var noml = document.getElementById('nomnoml-text1').innerHTML;

            function escapeHtml(str) {
                var div = document.createElement('div');
                div.appendChild(document.createTextNode(str));
                return div.innerHTML;
            }

            function createElement(str) {
                var div = document.createElement('div');
                div.innerHTML = str;
                var container = document.createDocumentFragment();
                for (var i=0; i < div.childNodes.length; i++) {
                    var node = div.childNodes[i].cloneNode(true);
                    container.appendChild(node);
                }
                return container.childNodes[0];
            }
            var elems = document.getElementsByClassName("nomnoml-text");
            while (elems.length>0) {
                var elem = elems[0];
                var noml = elem.innerHTML;

                try {
                    var canvas = createElement("<canvas></canvas>");
                    elem.parentNode.insertBefore(canvas,elem.nextSibling);

                    nomnoml.draw(canvas,noml);
                    elem.setAttribute("class","nomnoml-rendered");
                } catch (err) {
                    var errdiv = createElement("<div></div>");
                    var textDiv = createElement("<pre></pre>");
                    textDiv.innerText=elem.innerText;
                    var errnode = createElement("<div><pre>" + err + "</pre></div>");
                    errdiv.appendChild(textDiv);
                    errdiv.appendChild(errnode);
                    errdiv.setAttribute("class", "nomnoml-error");
                    elem.parentNode.replaceChild(errdiv,elem);
                }
                // refresh
                var elems = document.getElementsByClassName("nomnoml-text");
            }

        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
